#!/bin/bash
################################################################################
# Functional Annotation Pipeline - EggNOG7 Annotator Installation
# 
# Author: Aaron Kiggen
# Repository: aaronkiggen/Functional_Annotation_Pipeline
#
# Description: Downloads and sets up the EggNOG7 annotator tool
#
# Usage: Run this script on the login node of your HPC cluster
#        bash eggnog7_annotator
#
# Note: This script uses paths defined in config.env
#       The annotator will be installed to ${HOME}/tools by default
################################################################################

# Source configuration file to use consistent paths
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(dirname "${SCRIPT_DIR}")"
CONFIG_FILE="${PROJECT_ROOT}/config.env"

if [ -f "${CONFIG_FILE}" ]; then
    echo "✓ Sourcing configuration from ${CONFIG_FILE}"
    source "${CONFIG_FILE}"
fi

# Set installation directory
INSTALL_DIR="${HOME}/tools"

echo ""
echo "============================================================"
echo " Installing EggNOG7 Annotator"
echo "============================================================"
echo ""
echo "Installation directory: ${INSTALL_DIR}"
echo ""

# Create tools directory
echo "Creating installation directory..."
mkdir -p "${INSTALL_DIR}"
cd "${INSTALL_DIR}"

echo ""
echo "------------------------------------------------------------"
echo " Cloning EggNOG7 Annotator Repository"
echo "------------------------------------------------------------"
echo ""
echo "Cloning from GitHub: https://github.com/fischuu/eggnog7_annotator.git"
git clone https://github.com/fischuu/eggnog7_annotator.git

echo ""
echo "------------------------------------------------------------"
echo " Setting Up Environment Variable"
echo "------------------------------------------------------------"
echo ""
echo "Adding EggNOG7 annotator to PATH..."
export PATH="${INSTALL_DIR}/eggnog7_annotator:$PATH"
echo "  ✓ PATH updated for current session"

echo ""
echo "============================================================"
echo " EggNOG7 Annotator Installation Complete!"
echo "============================================================"
echo ""
echo "Installation location: ${INSTALL_DIR}/eggnog7_annotator"
echo ""
echo "⚠ Important: To use the annotator in future sessions, add this to your ~/.bashrc:"
echo "  export PATH=\"${INSTALL_DIR}/eggnog7_annotator:\$PATH\""
echo ""
echo "Or update your config.env with:"
echo "  EGGNOG7_SCRIPT=\"${INSTALL_DIR}/eggnog7_annotator/eggnog7_annotator.sh\""
echo ""
echo "The annotator script is located at:"
echo "  ${INSTALL_DIR}/eggnog7_annotator/eggnog7_annotator.sh"
echo ""
echo "Note: Before using the annotator, ensure you have downloaded the"
echo "EggNOG7 database using the 'environments_and_databases' script."
echo ""
################################################################################
